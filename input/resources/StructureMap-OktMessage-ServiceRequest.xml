<StructureMap xmlns="http://hl7.org/fhir">
    <id value="OktMessage-ServiceRequest" />
    <url value="http://hl7.no/fhir/ig/okt/StructureMap/OktMessage-ServiceRequest" />
    <name value="OktMessageServiceRequest" />
    <status value="draft" />
    <experimental value="true" />
    <description value="Map OktMessage to ServiceRequest" />
    <structure>
        <mode value="source" />
        <url value="http://hl7.no/fhir/ig/okt/StructureDefinition/OktMessage" />
        <alias value="NhnOktMessage" />
    </structure>
    <structure>
        <mode value="target" />
        <url value="http://hl7.org/fhir/StructureDefinition/ServiceRequest" />
        <alias value="FhirServiceRequest" />
    </structure>
    <group>
        <name value="OktMessageToServiceRequest" />
        <typeMode value="types" />
        <input>
            <name value="source" />
            <type value="NhnOktMessage" />
            <mode value="source" />
        </input>
        <input>
            <name value="target" />
            <type value="FhirServiceRequest" />
            <mode value="target" />
        </input>
        <rule>
            <name value="mapOccurrencePeriod" />
            <source>
                <context value="source" />
            </source>
            <target>
                <context value="target" />
                <element value="occurrence" />
                <variable value="occurrencePeriod" />
                <transform value="create" />
                <parameter>
                    <valueString value="Period" />
                </parameter>
            </target>
            <rule>
                <name value="setStart" />
                <source>
                    <context value="source" />
                    <element value="startDate" />
                    <variable value="startDate" />
                </source>
                <target>
                    <context value="occurrencePeriod" />
                    <contextType value="variable" />
                    <element value="start" />
                    <transform value="copy" />
                    <parameter>
                        <valueId value="startDate" />
                    </parameter>
                </target>
            </rule>
            <rule>
                <name value="setEnd" />
                <source>
                    <context value="source" />
                    <element value="endDate" />
                    <variable value="endDate" />
                </source>
                <target>
                    <context value="occurrencePeriod" />
                    <contextType value="variable" />
                    <element value="end" />
                    <transform value="copy" />
                    <parameter>
                        <valueId value="endDate" />
                    </parameter>
                </target>
            </rule>
        </rule>
        <rule>
            <name value="mapServiceDescription" />
            <source>
                <context value="source" />
                <element value="serviceDescription" />
                <variable value="serviceDescription" />
            </source>
            <target>
                <context value="target" />
                <element value="note" />
                <variable value="noteVariable" />
                <transform value="create" />
                <parameter>
                    <valueString value="Annotation" />
                </parameter>
            </target>
            <target>
                <context value="noteVariable" />
                <contextType value="variable" />
                <element value="text" />
                <transform value="copy" />
                <parameter>
                    <valueId value="serviceDescription" />
                </parameter>
            </target>
        </rule>
        <rule>
            <name value="mapStayType" />
            <source>
                <context value="source" />
                <element value="stayType" />
                <variable value="stayType" />
            </source>
            <target>
                <context value="target" />
                <element value="category" />
                <variable value="categoryVariable" />
                <transform value="cc" />
                <parameter>
                    <valueString value="http://hl7.no/fhir/ig/okt/CodeSystem/OktStayTypeCs" />
                </parameter>
                <parameter>
                    <valueId value="stayType" />
                </parameter>
            </target>
        </rule>
        <rule>
            <name value="mapWeeklyExtent" />
            <source>
                <context value="source" />
                <element value="weeklyExtent" />
                <variable value="weeklyExtent" />
            </source>
            <target>
                <context value="target" />
                <element value="quantity" />
                <variable value="quantityVariable" />
                <transform value="create" />
                <parameter>
                    <valueString value="Ratio" />
                </parameter>
            </target>
            <!-- Transform value 'qty' is unknown for the implementation -->
            <target>
                <context value="quantityVariable" />
                <contextType value="variable" />
                <element value="numerator" />
                <variable value="numeratorVariable" />
                <transform value="create" />
                <parameter>
                    <valueString value="Quantity" />
                </parameter>
            </target>
            <target>
                <context value="numeratorVariable" />
                <contextType value="variable" />
                <element value="value" />
                <transform value="copy" />
                <parameter>
                    <valueId value="weeklyExtent" />
                </parameter>
            </target>
            <target>
                <context value="numeratorVariable" />
                <contextType value="variable" />
                <element value="unit" />
                <transform value="copy" />
                <parameter>
                    <valueString value="h" />
                </parameter>
            </target>
            <target>
                <context value="numeratorVariable" />
                <contextType value="variable" />
                <element value="system" />
                <transform value="copy" />
                <parameter>
                    <valueString value="http://unitsofmeasure.org" />
                </parameter>
            </target>
            <target>
                <context value="numeratorVariable" />
                <contextType value="variable" />
                <element value="code" />
                <transform value="copy" />
                <parameter>
                    <valueString value="h" />
                </parameter>
            </target>
            <target>
                <context value="quantityVariable" />
                <contextType value="variable" />
                <element value="denominator" />
                <variable value="denominatorVariable" />
                <transform value="create" />
                <parameter>
                    <valueString value="Quantity" />
                </parameter>
            </target>
            <target>
                <context value="denominatorVariable" />
                <contextType value="variable" />
                <element value="value" />
                <transform value="copy" />
                <parameter>
                    <valueString value="1" />
                </parameter>
            </target>
            <target>
                <context value="denominatorVariable" />
                <contextType value="variable" />
                <element value="unit" />
                <transform value="copy" />
                <parameter>
                    <valueString value="wk" />
                </parameter>
            </target>
            <target>
                <context value="denominatorVariable" />
                <contextType value="variable" />
                <element value="system" />
                <transform value="copy" />
                <parameter>
                    <valueString value="http://unitsofmeasure.org" />
                </parameter>
            </target>
            <target>
                <context value="denominatorVariable" />
                <contextType value="variable" />
                <element value="code" />
                <transform value="copy" />
                <parameter>
                    <valueString value="wk" />
                </parameter>
            </target>
        </rule>
    </group>
</StructureMap>
